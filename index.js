!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.rechtspraak=n():e.rechtspraak=n()}(this,function(){return function(e){function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}var t={};return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=15)}([function(e,n,t){"use strict";function r(e){return"string"==typeof e}function s(e){return"number"==typeof e}function o(e,n){if("string"!=typeof e)throw new Error("Expected to be string: "+JSON.stringify(n||e));return e}function i(e,n){if(void 0===e)throw new Error("Expected to be defined: "+JSON.stringify(n||e));return e}function a(e,n){if(!u(e))throw new Error("Expected to be array: "+JSON.stringify(n||e));return e}function u(e){return!!e&&e.constructor===Array}Object.defineProperty(n,"__esModule",{value:!0}),n.isString=r,n.isNumber=s,n.mustBeString=o,n.mustBeDefined=i,n.mustBeArray=a,n.isArray=u,n.flattenMyArray=function(e,t){t||(t=[]);for(var r=0,s=e.length;r<s;r++){var o=e[r];if(Array.isArray(o))for(var i=0,a=o.length;i<a;i++){var u=o[i];Array.isArray(u)?n.flattenMyArray(u,t):t.push(u)}else t.push(o)}return t}},function(e,n,t){"use strict";function r(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function s(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i(e){return"number"==typeof e.braceDepth&&"string"==typeof e.type}Object.defineProperty(n,"__esModule",{value:!0});var a=function e(n,t,r){o(this,e),this.type=n,this.braceDepth=t,this.data=r};n.BibStringComponent=a;var u=function(e){function n(e,t){return o(this,n),r(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,0,t))}return s(n,e),n}(a);n.BibOuterStringComponent=u,n.isBibStringComponent=i},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function s(e){var n={};return Object.keys(e).forEach(function(t){switch(t){case"author":n[t]=i(e[t]);break;case"title":default:n[t]=a(e[t])}}),n}function o(e,n){if(p.isNumber(n)||p.isString(n))return n;if(l.isStringRef(n))return new l.StringRef(0,n.stringref);switch(p.mustBeString(n.type,n)){case"id":case"ws":case"number":return p.mustBeString(n.string);case"bracedstring":case"braced":if(!p.isArray(n.data))throw new Error("Expect array for data: "+JSON.stringify(n));return new f.BracedString(e,p.flattenMyArray(n.data).map(function(n){return o(e+1,n)}));case"quotedstring":if(!p.isArray(n.data))throw new Error("Expect array for data: "+JSON.stringify(n));var t=p.flattenMyArray(n.data);return new b.QuotedString(e,t.map(function(n){return o(e,n)}));default:throw new Error("Unexpected complex string type: "+n.type)}}function i(e){var n=a(e);return p.isNumber(n)?new y.Authors([n]):new y.Authors(n.data)}function a(e){if(p.isNumber(e))return e;var n=p.mustBeArray(e.data);switch(e.type){case"quotedstringwrapper":return 1===n.length&&p.isNumber(n[0])?n[0]:new b.OuterQuotedString(n.map(function(e){return o(0,e)}));case"bracedstringwrapper":return new f.OuterBracedString(n.map(function(e){return o(0,e)}));default:throw new Error("Unexpected value: "+JSON.stringify(e))}}function u(e){return"string"==typeof e.type&&"string"==typeof e._id&&!!e.fields}var c=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();Object.defineProperty(n,"__esModule",{value:!0});var b=t(4),f=t(3),p=t(0),l=t(5),y=t(14),m=function(){function e(n,t,s){r(this,e),this.type=n,this._id=t,this.fields=s,this.sortkey$="",this.title$=""}return c(e,[{key:"getField",value:function(e){return this.fields[e.toLowerCase()]}}]),e}();n.BibEntry=m,n.parseEntryFields=s,n.parseStringComponent=o,n.parseAuthors=i,n.parseFieldValue=a,n.isBibEntry=u},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function s(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function o(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}function i(e){return"bracedstringwrapper"===e.type}function a(e){return"bracedstring"===e.type}Object.defineProperty(n,"__esModule",{value:!0});var u=t(1),c=function(e){function n(e,t){return r(this,n),s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"bracedstring",e,t))}return o(n,e),n}(u.BibStringComponent);n.BracedString=c;var b=function(e){function n(e){return r(this,n),s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"bracedstringwrapper",e))}return o(n,e),n}(u.BibOuterStringComponent);n.OuterBracedString=b,n.isOuterBracedString=i,n.isBracedString=a},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function s(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function o(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}function i(e){return"quotedstringwrapper"===e.type}function a(e){return"quotedstring"===e.type}Object.defineProperty(n,"__esModule",{value:!0});var u=t(1),c=function(e){function n(e,t){return r(this,n),s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"quotedstring",e,t))}return o(n,e),n}(u.BibStringComponent);n.QuotedString=c;var b=function(e){function n(e){return r(this,n),s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"quotedstringwrapper",e))}return o(n,e),n}(u.BibOuterStringComponent);n.OuterQuotedString=b,n.isOuterQuotedString=i,n.isQuotedString=a},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function s(e){return"string"==typeof e.stringref}Object.defineProperty(n,"__esModule",{value:!0});var o=function e(n,t){r(this,e),this.braceDepth=n,this.stringref=t};n.StringRef=o,n.isStringRef=s},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function s(e){return"comment"===e.type&&a.isArray(e.data)}function o(e){return a.flattenMyArray(e).map(b)}var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();Object.defineProperty(n,"__esModule",{value:!0});var a=t(0),u=function(){function e(n){r(this,e),this.type="comment",this.data=n,this.string=n.join("")}return i(e,[{key:"toString",value:function(){return this.string}}]),e}();n.BibComment=u;var c=function(){function e(n,t){r(this,e),this.type=n,this.data=t,this.string=t.join("")}return i(e,[{key:"toString",value:function(){return this.string}}]),e}();n.CommentEntry=c,n.isBibComment=s;var b=function e(n){return a.isString(n)?n:"number"==typeof n?n.toString():"@bib"===n.type?"@"+a.mustBeString(n.string):"escapedEntry"===n.type?"\\"+e(n.data):a.mustBeString(n.string)};n.flattenPlainText=o},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function s(e){if(!p.isArray(e.data)||"NON_ENTRY"!==e.type)throw new Error;return new m.BibComment(m.flattenPlainText(e.data))}function o(e){switch(void 0===e?"undefined":a(e)){case"object":var n=e.data;if("string"==typeof n["@type"])return new y.BibEntry(n["@type"],n._id,y.parseEntryFields(n.fields));switch(p.mustBeString(n.type)){case"string":return _.newStringNode(n);case"preamble":return $.newPreambleNode(n);default:throw new Error("Unexpected entry parsed: "+n.type)}default:throw new Error("Expected object as data for entry")}}function i(e){var t=new c.Parser(b.grammar.ParserRules,b.grammar.ParserStart);t.feed(new f.default(e).readTokens());var r=t.results,s=r[0];return new h(n.parseBibEntriesAndNonEntries(s))}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();Object.defineProperty(n,"__esModule",{value:!0});var c=t(20),b=t(19),f=t(18),p=t(0),l=t(10),y=t(2),m=t(6),$=t(8),_=t(9),h=function(){function e(n){r(this,e),this.content=n,this.comments=n.filter(m.isBibComment).map(function(e){if(m.isBibComment(e))return e;throw new Error}),this.entries=n.filter(function(e){return y.isBibEntry(e)}).map(function(e){if(y.isBibEntry(e))return e;throw new Error});var t={};this.entries.forEach(function(e){var n=e._id.toLowerCase();if(t[n])throw new Error("Entry with id "+n+" was defined more than once");t[n]=e}),this.entries$=t,this.preambles=n.filter(function(e){return $.isPreamble(e)}).map(function(e){if($.isPreamble(e))return e;throw new Error}),this.preamble$=this.preambles.map(function(e){return e.toString()}).join("\n");var s={};this.content.forEach(function(e){if(l.isKeyVal(e)){if(s[e.key])throw new Error("String with id "+e.key+" was defined more than once");s[e.key]=e.value}}),this.strings=s,this.strings$=_.resolveStrings(s)}return u(e,[{key:"getEntry",value:function(e){return this.entries$[e.toLowerCase()]}}]),e}();n.BibFile=h,n.parseBibEntriesAndNonEntries=function(e){return e.map(function(e){switch(e.type){case"NON_ENTRY":return s(e);case"ENTRY":return o(e);default:throw new Error("Expected ENTRY or NON_ENTRY")}})},n.parseBibFile=i},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function s(e){return"preamble"===e.type&&!!e.data}function o(e){var n=u.parseBibEntriesAndNonEntries(a.mustBeArray(e.data));return new c(n)}var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();Object.defineProperty(n,"__esModule",{value:!0});var a=t(0),u=t(7),c=function(){function e(n){r(this,e),this.type="preamble",this.data=n,this.string=n.join("")}return i(e,[{key:"toString",value:function(){return this.string}}]),e}();n.Preamble=c,n.isPreamble=s,n.newPreambleNode=o},function(e,n,t){"use strict";function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(e){if(l.isKeyVal(e))return l.newKeyVal(e);if("string"!==e.type)throw new Error("Unexpected node: "+JSON.stringify(e));return o(e.data)}function i(e){var n={};return Object.keys(e).forEach(function(t){n[t]||(n[t]=c({},n,e,e[t]))}),n}function a(e){var n=o(e),t=n.key,r=n.value;return new d(t,r)}function u(e,n,t,r){return e.data.map(function(e){if(h.isString(e)||h.isNumber(e))return e;if(m.isStringRef(e))return p(n,r,e,t);if(y.isBibStringComponent(e))return b(e,n,t,r);throw new Error})}function c(e,n,t,r){return h.isNumber(r)?r:_.isOuterBracedString(r)||$.isOuterQuotedString(r)?f(r,e,n,t):m.isStringRef(r)?p(e,t,r,n):r}function b(e,n,t,r){var s=u(e,n,t,r),o=e.braceDepth;if($.isQuotedString(e))return new $.QuotedString(o,s);if(_.isBracedString(e))return new _.BracedString(o,s);if($.isOuterQuotedString(e))return new $.OuterQuotedString(s);if(_.isOuterBracedString(e))return new _.OuterBracedString(s);throw new Error}function f(e,n,t,r){var s=b(e,n,t,r);if(!_.isOuterBracedString(s)&&!$.isOuterQuotedString(s))throw new Error;return s}function p(e,n,t,s){var o=t.stringref;if(e[o])throw new Error("Cycle detected: "+o);if(s[o])return s[o];if(!n[o])throw new Error("Unresolved reference: "+JSON.stringify(t));return s[o]=c(Object.assign({},e,r({},o,!0)),s,n,n[o]),s[o]}Object.defineProperty(n,"__esModule",{value:!0});var l=t(10),y=t(1),m=t(5),$=t(4),_=t(3),h=t(0),d=function e(n,t){s(this,e),this.type="string",this.key=n,this.value=t};n.StringEntry=d,n.resolveStrings=i,n.newStringNode=a,n.resolveStringReferences=u,n.resolveStringReference=c,n.copyWithResolvedStringReferences=b,n.copyOuterWithResolvedStringReferences=f},function(e,n,t){"use strict";function r(e){return"string"==typeof e.key&&void 0!==e.value}function s(e){if(r(e))return{key:e.key,value:o.parseFieldValue(e.value)};throw new Error("Was not a KeyVal: "+JSON.stringify(e))}Object.defineProperty(n,"__esModule",{value:!0});var o=t(2);n.isKeyVal=r,n.newKeyVal=s},function(e,n,t){"use strict";function r(e){return{type:"number",string:e}}function s(e){return n.numericChars.hasOwnProperty(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.newNumber=r,n.numericChars={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0},n.isNum=s},function(e,n,t){"use strict";function r(e,n){return{type:e,string:n}}function s(e){return n.specialChars.hasOwnProperty(e)}function o(e){return n.escapableChars.hasOwnProperty(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.newToken=r,n.specialChars={"@":!0,"(":!0,")":!0,"{":!0,"}":!0,"#":!0,"=":!0,",":!0,"\\":!0,'"':!0},n.isSpecialChar=s,n.escapableChars={"\\":!0,"@":!0,"{":!0,"}":!0},n.isEscapableChar=o},function(e,n,t){"use strict";function r(e){return{type:"ws",string:e}}function s(e){return"string"==typeof e.string&&e.type===n.WS}function o(e){return n.singleWhitespaces.hasOwnProperty(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.WS="ws",n.newWhitespace=r,n.isWhitespace=s,n.singleWhitespaces={" ":!0,"\t":!0,"\r":!0,"\n":!0},n.isSingleWhiteSpaceCharacter=o},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function s(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function o(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0});var i=t(1),a=function(e){function n(e){return r(this,n),s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"authors",e))}return o(n,e),n}(i.BibOuterStringComponent);n.Authors=a},function(e,n,t){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),r(t(7)),r(t(2)),r(t(6)),r(t(8)),r(t(4)),r(t(3)),r(t(9)),r(t(5))},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.bibTypes={string:"@string",preamble:"@preamble",comment:"@comment",bib:"@bib"},n.isBibType=function(e){return n.bibTypes.hasOwnProperty(e)}},function(e,n,t){"use strict";function r(e){return{type:"id",string:e}}function s(e){return"id"===e.type&&"string"==typeof e.string}function o(e){return!(i.isSpecialChar(e)||u.isNum(e)||a.isSingleWhiteSpaceCharacter(e))}Object.defineProperty(n,"__esModule",{value:!0});var i=t(12),a=t(13),u=t(11);n.newIdToken=r,n.isIdToken=s,n.isIdChar=o},function(e,n,t){"use strict";function r(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();Object.defineProperty(n,"__esModule",{value:!0});var o=t(12),i=t(13),a=t(11),u=t(17),c=t(16),b=function(){function e(n){r(this,e),this.str=n,this.len=n.length,this.pos=0}return s(e,[{key:"getStringUntilNonEscapedChar",value:function(e){for(var n=[],t=this.pos;t<this.len+1;t++){if(this.pos=t,"\\"==this.str.charAt(t)&&this.str.charAt(t+1).match(e))t++,this.pos=t;else if(this.str.charAt(t).match(e))break;n.push(this.str.charAt(t))}return n.join("")}},{key:"readTokens",value:function(){for(var e=[],n=void 0;n=this.readNextToken();)e.push(n);return e}},{key:"readNextToken",value:function(){if(!(this.pos>=this.str.length)){var e=this.str.charAt(this.pos);return i.isSingleWhiteSpaceCharacter(e)?this.eatWhiteSpace():o.isSpecialChar(e)?this.eatSpecialChars(e):a.isNum(e)?this.eatNumericString(e):this.eatIdString()}}},{key:"eatIdString",value:function(){for(var e=[],n=this.pos,t=n;t<this.len+1;t++){this.pos=t;var r=this.str.charAt(t);if(!u.isIdChar(r))break;e.push(r)}return u.newIdToken(e.join("").trim())}},{key:"eatNumericString",value:function(e){for(var n=[e],t=this.pos+1,r=t;r<this.len+1;r++){this.pos=r;var s=this.str.charAt(r);if(!a.isNum(s))break;n.push(s)}var o=n.join("");if("0"===n[0])return a.newNumber(o);var i=Number.parseInt(o);return Number.isFinite(i)?i:a.newNumber(o)}},{key:"eatSpecialChars",value:function(e){if(this.pos++,"@"===e){var n=this.getStringUntilNonEscapedChar("{").trim().toLowerCase();return c.isBibType(n)?o.newToken(c.bibTypes[n],n):o.newToken("@bib",n)}return e}},{key:"eatWhiteSpace",value:function(){for(var e=[];this.pos<this.len+1;){var n=this.str.charAt(this.pos);if(!i.isSingleWhiteSpaceCharacter(n))break;e.push(n),this.pos++}return i.newWhitespace(e.join(""))}}]),e}();n.default=b},function(e,n,t){"use strict";function r(e){return e[0]}function s(e,n){if("keyval"!==n.type)throw new Error("Expected a keyval object");var t=n.key.toLowerCase();return e.fields[t]?void console.log("WARNING: field '"+t+"' was already defined on "+e["@type"]+" object with id '"+e._id+"'. Ignoring this value."):(e.fields[t]=n.value,e)}function o(e){for(var n=[],t=0;t<e.length;t++)if("object"===i(e[t])){if(!e[t].string)throw new Error("Expected token to have a string field called 'string' in object "+JSON.stringify(e[t]));n.push(e[t].string)}else{if("string"!=typeof e[t]&&"number"!=typeof e[t])throw new Error("Could not handle token "+JSON.stringify(e[t])+" in array "+JSON.stringify(e));n.push(e[t])}return n.join("")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(n,"__esModule",{value:!0});var a=function(e){return e.constructor===Number||"object"===(void 0===e?"undefined":i(e))&&"number"===e.type},u={test:function(e){return"object"===(void 0===e?"undefined":i(e))&&"id"===e.type}},c={test:function(e){return"object"===(void 0===e?"undefined":i(e))&&"@bib"===e.type}},b={test:function(e){return"object"===(void 0===e?"undefined":i(e))&&"@string"===e.type}},f={test:function(e){return"object"===(void 0===e?"undefined":i(e))&&"@preamble"===e.type}},p={test:function(e){return"object"===(void 0===e?"undefined":i(e))&&"@comment"===e.type}},l={test:function(e){return"object"===(void 0===e?"undefined":i(e))&&"ws"===e.type}},y={test:a},m={literal:"#"},$={literal:"="},_={literal:"\\"},h={literal:"("},d={literal:")"},g={literal:"{"},x={literal:"}"},v={literal:'"'},w={literal:","};n.grammar={Lexer:void 0,ParserRules:[{name:"main$ebnf$1",symbols:["non_entry"],postprocess:r},{name:"main$ebnf$1",symbols:[],postprocess:function(){}},{name:"main$ebnf$2",symbols:[]},{name:"main$ebnf$2$subexpression$1$ebnf$1",symbols:["non_entry"],postprocess:r},{name:"main$ebnf$2$subexpression$1$ebnf$1",symbols:[],postprocess:function(){}},{name:"main$ebnf$2$subexpression$1",symbols:["entry","main$ebnf$2$subexpression$1$ebnf$1"]},{name:"main$ebnf$2",symbols:["main$ebnf$2","main$ebnf$2$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"main",symbols:["main$ebnf$1","main$ebnf$2"],postprocess:function(e){var n=[];e[0]&&n.push({type:"NON_ENTRY",data:e[0]});for(var t=0;t<e[1].length;t++)n.push({type:"ENTRY",data:e[1][t][0]}),e[1][t][1]&&n.push({type:"NON_ENTRY",data:e[1][t][1]});return n}},{name:"_$ebnf$1",symbols:[]},{name:"_$ebnf$1",symbols:["_$ebnf$1",l],postprocess:function(e){return e[0].concat([e[1]])}},{name:"_",symbols:["_$ebnf$1"]},{name:"entry_decl$subexpression$1",symbols:[c]},{name:"entry_decl$subexpression$1",symbols:[b]},{name:"entry_decl$subexpression$1",symbols:[f]},{name:"entry_decl$subexpression$1",symbols:[p]},{name:"entry_decl",symbols:["entry_decl$subexpression$1"],postprocess:function(e){return e[0][0]}},{name:"entry$subexpression$1",symbols:["bib_entry"]},{name:"entry$subexpression$1",symbols:["string_entry"]},{name:"entry$subexpression$1",symbols:["preamble_entry"]},{name:"entry$subexpression$1",symbols:["comment_entry"]},{name:"entry",symbols:["entry$subexpression$1"],postprocess:function(e){return e[0][0]}},{name:"comment",symbols:["main"],postprocess:function(e){return e[0]}},{name:"comment_liberal$ebnf$1",symbols:[]},{name:"comment_liberal$ebnf$1$subexpression$1",symbols:[/./]},{name:"comment_liberal$ebnf$1",symbols:["comment_liberal$ebnf$1","comment_liberal$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"comment_liberal",symbols:["comment_liberal$ebnf$1"],postprocess:function(e){for(var n=[],t=0;t<e[0].length;t++)n.push(e[0][t][0]);return n}},{name:"entry_body_comment$subexpression$1$macrocall$2",symbols:["comment"]},{name:"entry_body_comment$subexpression$1$macrocall$1",symbols:[h,"entry_body_comment$subexpression$1$macrocall$2",d],postprocess:function(e){return e[1]}},{name:"entry_body_comment$subexpression$1",symbols:["entry_body_comment$subexpression$1$macrocall$1"]},{name:"entry_body_comment$subexpression$1$macrocall$4",symbols:["comment"]},{name:"entry_body_comment$subexpression$1$macrocall$3",symbols:[g,"entry_body_comment$subexpression$1$macrocall$4",x],postprocess:function(e){return e[1]}},{name:"entry_body_comment$subexpression$1",symbols:["entry_body_comment$subexpression$1$macrocall$3"]},{name:"entry_body_comment",symbols:["entry_body_comment$subexpression$1"],postprocess:function(e){return e[0][0][0]}},{name:"entry_body_string$subexpression$1$macrocall$2",symbols:["keyval"]},{name:"entry_body_string$subexpression$1$macrocall$1",symbols:[h,"_","entry_body_string$subexpression$1$macrocall$2","_",d],postprocess:function(e){return e[2]}},{name:"entry_body_string$subexpression$1",symbols:["entry_body_string$subexpression$1$macrocall$1"]},{name:"entry_body_string$subexpression$1$macrocall$4",symbols:["keyval"]},{name:"entry_body_string$subexpression$1$macrocall$3",symbols:[g,"_","entry_body_string$subexpression$1$macrocall$4","_",x],postprocess:function(e){return e[2]}},{name:"entry_body_string$subexpression$1",symbols:["entry_body_string$subexpression$1$macrocall$3"]},{name:"entry_body_string",symbols:["entry_body_string$subexpression$1"],postprocess:function(e){return e[0][0][0]}},{name:"entry_body_bib$subexpression$1$macrocall$2",symbols:["bib_content"]},{name:"entry_body_bib$subexpression$1$macrocall$1",symbols:[h,"_","entry_body_bib$subexpression$1$macrocall$2","_",d],postprocess:function(e){return e[2]}},{name:"entry_body_bib$subexpression$1",symbols:["entry_body_bib$subexpression$1$macrocall$1"]},{name:"entry_body_bib$subexpression$1$macrocall$4",symbols:["bib_content"]},{name:"entry_body_bib$subexpression$1$macrocall$3",symbols:[g,"_","entry_body_bib$subexpression$1$macrocall$4","_",x],postprocess:function(e){return e[2]}},{name:"entry_body_bib$subexpression$1",symbols:["entry_body_bib$subexpression$1$macrocall$3"]},{name:"entry_body_bib",symbols:["entry_body_bib$subexpression$1"],postprocess:function(e){return e[0][0][0]}},{name:"bib_content$ebnf$1",symbols:[]},{name:"bib_content$ebnf$1$subexpression$1",symbols:["keyval","_",w,"_"]},{name:"bib_content$ebnf$1",symbols:["bib_content$ebnf$1","bib_content$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"bib_content$ebnf$2$subexpression$1",symbols:["_",w]},{name:"bib_content$ebnf$2",symbols:["bib_content$ebnf$2$subexpression$1"],postprocess:r},{name:"bib_content$ebnf$2",symbols:[],postprocess:function(){}},{name:"bib_content",symbols:["key_string","_",w,"_","bib_content$ebnf$1","keyval","bib_content$ebnf$2"],postprocess:function(e){for(var n={_id:e[0],fields:[]},t=e[4],r=0;r<t.length;r++)n.fields.push(t[r][0]);return n.fields.push(e[5]),n}},{name:"bib_entry",symbols:[c,"_","entry_body_bib"],postprocess:function(e){var n={_id:e[2]._id};n["@type"]=e[0].string,n.fields={};for(var t=e[2].fields,r=0;r<t.length;r++)s(n,t[r]);return n}},{name:"string_entry",symbols:[b,"_","entry_body_string"],postprocess:function(e){return{type:"string",data:e[2]}}},{name:"preamble_entry",symbols:[f,"_","entry_body_comment"],postprocess:function(e){return{type:"preamble",data:e[2]}}},{name:"comment_entry",symbols:[p,"_","entry_body_comment"],postprocess:function(e){return{type:"comment",data:e[2]}}},{name:"keyval",symbols:["key_string","_",$,"_","value_string"],postprocess:function(e){return{type:"keyval",key:e[0],value:e[4]}}},{name:"braced_string$ebnf$1",symbols:[]},{name:"braced_string$ebnf$1$subexpression$1",symbols:["non_brace"]},{name:"braced_string$ebnf$1$subexpression$1",symbols:["braced_string"]},{name:"braced_string$ebnf$1",symbols:["braced_string$ebnf$1","braced_string$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"braced_string",symbols:[g,"braced_string$ebnf$1",x],postprocess:function(e){var n=[];for(var t in e[1])n.push(e[1][t][0]);return{type:"braced",data:n}}},{name:"quoted_string$ebnf$1",symbols:[]},{name:"quoted_string$ebnf$1$subexpression$1",symbols:["escaped_quote"]},{name:"quoted_string$ebnf$1$subexpression$1",symbols:["non_quote_non_brace"]},{name:"quoted_string$ebnf$1$subexpression$1",symbols:["braced_string"]},{name:"quoted_string$ebnf$1",symbols:["quoted_string$ebnf$1","quoted_string$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"quoted_string",symbols:[v,"quoted_string$ebnf$1",v],postprocess:function(e){var n=[];for(var t in e[1])n.push(e[1][t][0]);return{type:"quotedstring",data:n}}},{name:"escaped_quote",symbols:[_,v]},{name:"non_quote_non_brace$subexpression$1",symbols:[u]},{name:"non_quote_non_brace$subexpression$1",symbols:[c]},{name:"non_quote_non_brace$subexpression$1",symbols:[b]},{name:"non_quote_non_brace$subexpression$1",symbols:[f]},{name:"non_quote_non_brace$subexpression$1",symbols:[p]},{name:"non_quote_non_brace$subexpression$1",symbols:[l]},{name:"non_quote_non_brace$subexpression$1",symbols:[y]},{name:"non_quote_non_brace$subexpression$1",symbols:[m]},{name:"non_quote_non_brace$subexpression$1",symbols:[$]},{name:"non_quote_non_brace$subexpression$1",symbols:[_]},{name:"non_quote_non_brace$subexpression$1",symbols:[h]},{name:"non_quote_non_brace$subexpression$1",symbols:[d]},{name:"non_quote_non_brace$subexpression$1",symbols:[w]},{name:"non_quote_non_brace",symbols:["non_quote_non_brace$subexpression$1"]},{name:"key_string$ebnf$1",symbols:["stringreftoken"]},{name:"key_string$ebnf$1",symbols:["key_string$ebnf$1","stringreftoken"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"key_string",symbols:["key_string$ebnf$1"],postprocess:function(e){return o(e[0]).toLowerCase()}},{name:"value_string$subexpression$1$ebnf$1",symbols:[]},{name:"value_string$subexpression$1$ebnf$1$subexpression$1",symbols:["_",m,"_","quoted_string_or_ref"]},{name:"value_string$subexpression$1$ebnf$1",symbols:["value_string$subexpression$1$ebnf$1","value_string$subexpression$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"value_string$subexpression$1",symbols:["quoted_string_or_ref","value_string$subexpression$1$ebnf$1"]},{name:"value_string$subexpression$1",symbols:["braced_string"]},{name:"value_string",symbols:["value_string$subexpression$1"],postprocess:function(e){var n=e[0];if(2===n.length){var t=[];t.push(n[0]);for(var r=0;r<n[1].length;r++)t.push(n[1][r][3]);return{type:"quotedstringwrapper",data:t}}if("braced"===n[0].type)return{type:"bracedstringwrapper",data:n[0].data};throw new Error("Don't know how to handle value "+JSON.stringify(n[0]))}},{name:"quoted_string_or_ref$subexpression$1",symbols:["quoted_string"]},{name:"quoted_string_or_ref$subexpression$1",symbols:["string_ref"]},{name:"quoted_string_or_ref$subexpression$1",symbols:[y]},{name:"quoted_string_or_ref",symbols:["quoted_string_or_ref$subexpression$1"],postprocess:function(e){return e[0][0].type,e[0][0]}},{name:"string_ref$subexpression$1$ebnf$1",symbols:[]},{name:"string_ref$subexpression$1$ebnf$1",symbols:["string_ref$subexpression$1$ebnf$1","stringreftoken"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"string_ref$subexpression$1",symbols:["stringreftoken_n_num","string_ref$subexpression$1$ebnf$1"]},{name:"string_ref",symbols:["string_ref$subexpression$1"],postprocess:function(e){return{stringref:e[0][0]+o(e[0][1])}}},{name:"stringreftoken$subexpression$1",symbols:[_]},{name:"stringreftoken$subexpression$1",symbols:[h]},{name:"stringreftoken$subexpression$1",symbols:[d]},{name:"stringreftoken$subexpression$1",symbols:[u]},{name:"stringreftoken$subexpression$1",symbols:[y]},{name:"stringreftoken$subexpression$1",symbols:[c]},{name:"stringreftoken$subexpression$1",symbols:[b]},{name:"stringreftoken$subexpression$1",symbols:[f]},{name:"stringreftoken$subexpression$1",symbols:[p]},{name:"stringreftoken",symbols:["stringreftoken$subexpression$1"],postprocess:function(e){if("object"===i(e[0][0])){if(!e[0][0].string)throw new Error("Expected "+e[0]+"to have a 'string' field");return e[0][0].string}if("string"!=typeof e[0][0]&&"number"!=typeof e[0][0])throw new Error("Expected "+e[0][0]+" to be a string");return e[0][0]}},{name:"stringreftoken_n_num$subexpression$1",symbols:[_]},{name:"stringreftoken_n_num$subexpression$1",symbols:[h]},{name:"stringreftoken_n_num$subexpression$1",symbols:[d]},{name:"stringreftoken_n_num$subexpression$1",symbols:[u]},{name:"stringreftoken_n_num$subexpression$1",symbols:[c]},{name:"stringreftoken_n_num$subexpression$1",symbols:[b]},{name:"stringreftoken_n_num$subexpression$1",symbols:[f]},{name:"stringreftoken_n_num$subexpression$1",symbols:[p]},{name:"stringreftoken_n_num",symbols:["stringreftoken_n_num$subexpression$1"],postprocess:function(e){if("object"===i(e[0][0])){if(!e[0][0].string)throw new Error("Expected "+e[0]+"to have a 'string' field");return e[0][0].string}if("string"!=typeof e[0][0]&&"number"!=typeof e[0][0])throw new Error("Expected "+e[0][0]+" to be a string");return e[0][0]}},{name:"non_brace$subexpression$1",symbols:[_]},{name:"non_brace$subexpression$1",symbols:[h]},{name:"non_brace$subexpression$1",symbols:[d]},{name:"non_brace$subexpression$1",symbols:[u]},{name:"non_brace$subexpression$1",symbols:[v]},{name:"non_brace$subexpression$1",symbols:[l]},{name:"non_brace$subexpression$1",symbols:[y]},{name:"non_brace$subexpression$1",symbols:[w]},{name:"non_brace$subexpression$1",symbols:[c]},{name:"non_brace$subexpression$1",symbols:[b]},{name:"non_brace$subexpression$1",symbols:[f]},{name:"non_brace$subexpression$1",symbols:[p]},{name:"non_brace$subexpression$1",symbols:[m]},{name:"non_brace$subexpression$1",symbols:[$]},{name:"non_brace",symbols:["non_brace$subexpression$1"],postprocess:function(e){return e[0][0]}},{name:"non_bracket$subexpression$1",symbols:[_]},{name:"non_bracket$subexpression$1",symbols:[u]},{name:"non_bracket$subexpression$1",symbols:[v]},{name:"non_bracket$subexpression$1",symbols:[l]},{name:"non_bracket$subexpression$1",symbols:[y]},{name:"non_bracket$subexpression$1",symbols:[w]},{name:"non_bracket$subexpression$1",symbols:[c]},{name:"non_bracket$subexpression$1",symbols:[b]},{name:"non_bracket$subexpression$1",symbols:[f]},{name:"non_bracket$subexpression$1",symbols:[p]},{name:"non_bracket$subexpression$1",symbols:[m]},{name:"non_bracket$subexpression$1",symbols:[$]},{name:"non_bracket",symbols:["non_bracket$subexpression$1"],postprocess:function(e){return e[0][0]}},{name:"non_entry$ebnf$1$subexpression$1",symbols:["escaped_entry"]},{name:"non_entry$ebnf$1$subexpression$1",symbols:["escaped_escape"]},{name:"non_entry$ebnf$1$subexpression$1",symbols:["escaped_non_esc_outside_entry"]},{name:"non_entry$ebnf$1$subexpression$1",symbols:["non_esc_outside_entry"]},{name:"non_entry$ebnf$1",symbols:["non_entry$ebnf$1$subexpression$1"]},{name:"non_entry$ebnf$1$subexpression$2",symbols:["escaped_entry"]},{name:"non_entry$ebnf$1$subexpression$2",symbols:["escaped_escape"]},{name:"non_entry$ebnf$1$subexpression$2",symbols:["escaped_non_esc_outside_entry"]},{name:"non_entry$ebnf$1$subexpression$2",symbols:["non_esc_outside_entry"]},{name:"non_entry$ebnf$1",symbols:["non_entry$ebnf$1","non_entry$ebnf$1$subexpression$2"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"non_entry",symbols:["non_entry$ebnf$1"],postprocess:function(e){for(var n=[],t=0;t<e[0].length;t++)n.push(e[0][t][0]);return n}},{name:"escaped_escape",symbols:[_,_],postprocess:function(){return"\\"}},{name:"escaped_entry",symbols:[_,"entry_decl"],postprocess:function(e){return{type:"escapedEntry",data:e[1]}}},{name:"escaped_non_esc_outside_entry",symbols:[_,"non_esc_outside_entry"],postprocess:function(e){return e}},{name:"non_esc_outside_entry$subexpression$1",symbols:[u]},{name:"non_esc_outside_entry$subexpression$1",symbols:[l]},{name:"non_esc_outside_entry$subexpression$1",symbols:[y]},{name:"non_esc_outside_entry$subexpression$1",symbols:[m]},{name:"non_esc_outside_entry$subexpression$1",symbols:[$]},{name:"non_esc_outside_entry$subexpression$1",symbols:[h]},{name:"non_esc_outside_entry$subexpression$1",symbols:[d]},{name:"non_esc_outside_entry$subexpression$1",symbols:[g]},{name:"non_esc_outside_entry$subexpression$1",symbols:[x]},{name:"non_esc_outside_entry$subexpression$1",symbols:[v]},{name:"non_esc_outside_entry$subexpression$1",symbols:[w]},{name:"non_esc_outside_entry",symbols:["non_esc_outside_entry$subexpression$1"],postprocess:function(e){return e[0][0]}}],ParserStart:"main"}},function(e,n){!function(n,t){"object"==typeof e&&e.exports?e.exports=t():n.nearley=t()}(this,function(){function e(n,t,r){return this.id=++e.highestId,this.name=n,this.symbols=t,this.postprocess=r,this}function n(e,n,t,r){this.rule=e,this.dot=n,this.reference=t,this.data=[],this.wantedBy=r,this.isComplete=this.dot===e.symbols.length}function t(e,n){this.grammar=e,this.index=n,this.states=[],this.wants={},this.scannable=[],this.completed={}}function r(e,n){this.rules=e,this.start=n||this.rules[0].name;var t=this.byName={};this.rules.forEach(function(e){t.hasOwnProperty(e.name)||(t[e.name]=[]),t[e.name].push(e)})}function s(){this.reset("")}function o(e,n,o){if(e instanceof r)var i=e,o=n;else var i=r.fromCompiled(e,n);this.grammar=i,this.options={keepHistory:!1,lexer:i.lexer||new s};for(var a in o||{})this.options[a]=o[a];this.lexer=this.options.lexer,this.lexerState=void 0;var u=new t(i,0);this.table=[u];u.wants[i.start]=[],u.predict(i.start),u.process(),this.current=0}return e.highestId=0,e.prototype.toString=function(e){function n(e){return e.literal?JSON.stringify(e.literal):e.type?"%"+e.type:e.toString()}var t=void 0===e?this.symbols.map(n).join(" "):this.symbols.slice(0,e).map(n).join(" ")+" ● "+this.symbols.slice(e).map(n).join(" ");return this.name+" → "+t},n.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},n.prototype.nextState=function(e){var t=new n(this.rule,this.dot+1,this.reference,this.wantedBy);return t.left=this,t.right=e,t.isComplete&&(t.data=t.build()),t},n.prototype.build=function(){var e=[],n=this;do{e.push(n.right.data),n=n.left}while(n.left);return e.reverse(),e},n.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,o.fail))},t.prototype.process=function(e){for(var n=this.states,t=this.wants,r=this.completed,s=0;s<n.length;s++){var i=n[s];if(i.isComplete){if(i.finish(),i.data!==o.fail){for(var a=i.wantedBy,u=a.length;u--;){var c=a[u];this.complete(c,i)}if(i.reference===this.index){var b=i.rule.name;(this.completed[b]=this.completed[b]||[]).push(i)}}}else{var b=i.rule.symbols[i.dot];if("string"!=typeof b){this.scannable.push(i);continue}if(t[b]){if(t[b].push(i),r.hasOwnProperty(b))for(var f=r[b],u=0;u<f.length;u++){var p=f[u];this.complete(i,p)}}else t[b]=[i],this.predict(b)}}},t.prototype.predict=function(e){for(var t=this.grammar.byName[e]||[],r=0;r<t.length;r++){var s=t[r],o=this.wants[e],i=new n(s,0,this.index,o);this.states.push(i)}},t.prototype.complete=function(e,n){var t=n.rule.name;if(e.rule.symbols[e.dot]===t){var r=e.nextState(n);this.states.push(r)}},r.fromCompiled=function(n,t){var s=n.Lexer;n.ParserStart&&(t=n.ParserStart,n=n.ParserRules);var n=n.map(function(n){return new e(n.name,n.symbols,n.postprocess)}),o=new r(n,t);return o.lexer=s,o},s.prototype.reset=function(e,n){this.buffer=e,this.index=0,this.line=n?n.line:1,this.lastLineBreak=n?-n.col:0},s.prototype.next=function(){if(this.index<this.buffer.length){var e=this.buffer[this.index++];return"\n"===e&&(this.line+=1,this.lastLineBreak=this.index),{value:e}}},s.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},s.prototype.formatError=function(e,n){var t=this.buffer;if("string"==typeof t){var r=t.indexOf("\n",this.index);-1===r&&(r=t.length);var s=t.substring(this.lastLineBreak,r),o=this.index-this.lastLineBreak;return n+=" at line "+this.line+" col "+o+":\n\n",n+="  "+s+"\n",n+="  "+Array(o).join(" ")+"^"}return n+" at index "+(this.index-1)},o.fail={},o.prototype.feed=function(e){var n=this.lexer;for(n.reset(e,this.lexerState);token=n.next();){var r=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var o=this.current+1,i=new t(this.grammar,o);this.table.push(i);for(var a=token.value,u=n.constructor===s?token.value:token,c=r.scannable,b=c.length;b--;){var f=c[b],p=f.rule.symbols[f.dot];if(p.test?p.test(u):p.type?p.type===token.type:p.literal===a){var l=f.nextState({data:u,token:token,isToken:!0,reference:o-1});i.states.push(l)}}if(i.process(),0===i.states.length){var y=this.lexer.formatError(token,"invalid syntax")+"\n";y+="Unexpected "+(token.type?token.type+" token: ":""),y+=JSON.stringify(void 0!==token.value?token.value:token)+"\n";var m=new Error(y);throw m.offset=this.current,m.token=token,m}this.options.keepHistory&&(r.lexerState=n.save()),this.current++}return r&&(this.lexerState=n.save()),this.results=this.finish(),this},o.prototype.save=function(){var e=this.table[this.current];return e.lexerState=this.lexerState,e},o.prototype.restore=function(e){var n=e.index;this.current=n,this.table[n]=e,this.table.splice(n+1),this.lexerState=e.lexerState,this.results=this.finish()},o.prototype.rewind=function(e){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[e])},o.prototype.finish=function(){var e=[],n=this.grammar.start;return this.table[this.table.length-1].states.forEach(function(t){t.rule.name===n&&t.dot===t.rule.symbols.length&&0===t.reference&&t.data!==o.fail&&e.push(t)}),e.map(function(e){return e.data})},{Parser:o,Grammar:r,Rule:e}})}])});
//# sourceMappingURL=index.js.map